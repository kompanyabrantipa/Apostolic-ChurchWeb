<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-time Sync Test - Apostolic Church International</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .test-section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
      }
      .button {
        background: #007cba;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .button:hover {
        background: #005a87;
      }
      .button.success {
        background: #28a745;
      }
      .button.danger {
        background: #dc3545;
      }
      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .content-display {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .content-item {
        background: white;
        padding: 10px;
        margin: 5px 0;
        border-radius: 3px;
        border-left: 4px solid #007cba;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîÑ Real-time Sync Test</h1>
      <p>
        This page tests the real-time synchronization between the admin
        dashboard and frontend pages.
      </p>

      <div class="test-section">
        <h3>üìä Current Data Status</h3>
        <button class="button" onclick="checkCurrentData()">
          Check Current Data
        </button>
        <button class="button success" onclick="seedSampleData()">
          Seed Sample Data
        </button>
        <button class="button danger" onclick="clearAllData()">
          Clear All Data
        </button>
        <div id="dataStatus" class="status info">
          Click "Check Current Data" to see current localStorage content.
        </div>
      </div>

      <div class="test-section">
        <h3>üéØ Sync Event Testing</h3>
        <button class="button" onclick="testCreateBlog()">
          Test Create Blog
        </button>
        <button class="button" onclick="testCreateEvent()">
          Test Create Event
        </button>
        <button class="button" onclick="testCreateSermon()">
          Test Create Sermon
        </button>
        <div id="syncStatus" class="status info">
          Click buttons above to test sync events.
        </div>
      </div>

      <div class="test-section">
        <h3>üß™ Automated Testing</h3>
        <button class="button" onclick="runAllTests()">Run All Tests</button>
        <button class="button" onclick="demonstrateSync()">
          Demonstrate Sync
        </button>
        <div id="testResults" class="status info">
          Click "Run All Tests" to verify sync functionality.
        </div>
      </div>

      <div class="test-section">
        <h3>üöÄ Comprehensive Testing</h3>
        <button class="button" onclick="runComprehensiveTest()">
          Run Comprehensive Test
        </button>
        <button class="button" onclick="demonstrateWorkflow()">
          Demonstrate Complete Workflow
        </button>
        <div id="comprehensiveResults" class="status info">
          Click "Run Comprehensive Test" for complete verification.
        </div>
      </div>

      <div class="test-section">
        <h3>üìù Event Log</h3>
        <button class="button" onclick="clearLog()">Clear Log</button>
        <div id="eventLog" class="log">Event log will appear here...</div>
      </div>

      <div class="test-section">
        <h3>üìã Current Content</h3>
        <button class="button" onclick="displayCurrentContent()">
          Refresh Content Display
        </button>
        <div id="contentDisplay" class="content-display">
          <p>Click "Refresh Content Display" to see current content.</p>
        </div>
      </div>

      <div class="test-section">
        <h3>üîó Quick Links</h3>
        <a href="dashboard.html" class="button" target="_blank"
          >Open Admin Dashboard</a
        >
        <a href="blog.html" class="button" target="_blank">Open Blog Page</a>
        <a href="events.html" class="button" target="_blank"
          >Open Events Page</a
        >
        <a href="sermons.html" class="button" target="_blank"
          >Open Sermons Page</a
        >
      </div>
    </div>

    <!-- Include required scripts -->
    <script src="js/data-service.js"></script>
    <script src="js/sample-data-generator.js"></script>
    <script src="js/sync-verification.js"></script>
    <script src="js/comprehensive-sync-test.js"></script>

    <script>
      // Event log functionality
      function logEvent(message, type = "info") {
        const log = document.getElementById("eventLog");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}\n`;
        log.textContent += logEntry;
        log.scrollTop = log.scrollHeight;

        console.log(`Sync Test: ${message}`);
      }

      function clearLog() {
        document.getElementById("eventLog").textContent =
          "Event log cleared...\n";
      }

      // Data status functions
      function checkCurrentData() {
        try {
          const blogs = JSON.parse(localStorage.getItem("blogs") || "[]");
          const events = JSON.parse(localStorage.getItem("events") || "[]");
          const sermons = JSON.parse(localStorage.getItem("sermons") || "[]");

          const status = document.getElementById("dataStatus");
          status.className = "status success";
          status.innerHTML = `
                    <strong>Current Data:</strong><br>
                    üìù Blogs: ${blogs.length} items<br>
                    üìÖ Events: ${events.length} items<br>
                    üé§ Sermons: ${sermons.length} items
                `;

          logEvent(
            `Data check: ${blogs.length} blogs, ${events.length} events, ${sermons.length} sermons`
          );
        } catch (error) {
          const status = document.getElementById("dataStatus");
          status.className = "status error";
          status.textContent = "Error checking data: " + error.message;
          logEvent("Error checking data: " + error.message, "error");
        }
      }

      function seedSampleData() {
        try {
          const result = SampleDataGenerator.seedAllSampleData();
          if (result.success) {
            const status = document.getElementById("dataStatus");
            status.className = "status success";
            status.innerHTML = `
                        <strong>Sample Data Seeded Successfully!</strong><br>
                        üìù ${result.blogs} blog posts created<br>
                        üìÖ ${result.events} events created<br>
                        üé§ ${result.sermons} sermons created
                    `;
            logEvent(
              `Sample data seeded: ${result.blogs} blogs, ${result.events} events, ${result.sermons} sermons`
            );
            displayCurrentContent();
          } else {
            throw new Error(result.error);
          }
        } catch (error) {
          const status = document.getElementById("dataStatus");
          status.className = "status error";
          status.textContent = "Error seeding data: " + error.message;
          logEvent("Error seeding data: " + error.message, "error");
        }
      }

      function clearAllData() {
        try {
          localStorage.removeItem("blogs");
          localStorage.removeItem("events");
          localStorage.removeItem("sermons");
          localStorage.removeItem("lastSync");

          const status = document.getElementById("dataStatus");
          status.className = "status info";
          status.textContent = "All data cleared successfully.";
          logEvent("All data cleared");
          displayCurrentContent();
        } catch (error) {
          const status = document.getElementById("dataStatus");
          status.className = "status error";
          status.textContent = "Error clearing data: " + error.message;
          logEvent("Error clearing data: " + error.message, "error");
        }
      }

      // Sync testing functions
      function testCreateBlog() {
        try {
          const testBlog = {
            title: "Test Blog Post - " + new Date().toLocaleTimeString(),
            summary: "This is a test blog post created for sync testing.",
            content:
              "<p>This blog post was created to test the real-time sync functionality.</p>",
            imageUrl: "images/test.jpg",
            status: "published",
          };

          const newBlog = DataService.create("blogs", testBlog);

          const status = document.getElementById("syncStatus");
          status.className = "status success";
          status.textContent = `‚úÖ Test blog created: "${newBlog.title}"`;
          logEvent(`Created test blog: ${newBlog.title}`);
          displayCurrentContent();
        } catch (error) {
          const status = document.getElementById("syncStatus");
          status.className = "status error";
          status.textContent = "Error creating test blog: " + error.message;
          logEvent("Error creating test blog: " + error.message, "error");
        }
      }

      function testCreateEvent() {
        try {
          const testEvent = {
            title: "Test Event - " + new Date().toLocaleTimeString(),
            date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 1 week from now
            location: "Test Location",
            description:
              "<p>This event was created to test the real-time sync functionality.</p>",
            imageUrl: "images/test.jpg",
            status: "published",
          };

          const newEvent = DataService.create("events", testEvent);

          const status = document.getElementById("syncStatus");
          status.className = "status success";
          status.textContent = `‚úÖ Test event created: "${newEvent.title}"`;
          logEvent(`Created test event: ${newEvent.title}`);
          displayCurrentContent();
        } catch (error) {
          const status = document.getElementById("syncStatus");
          status.className = "status error";
          status.textContent = "Error creating test event: " + error.message;
          logEvent("Error creating test event: " + error.message, "error");
        }
      }

      function testCreateSermon() {
        try {
          const testSermon = {
            title: "Test Sermon - " + new Date().toLocaleTimeString(),
            speaker: "Test Speaker",
            date: new Date().toISOString(),
            description:
              "<p>This sermon was created to test the real-time sync functionality.</p>",
            videoUrl: "",
            audioUrl: "",
            thumbnailUrl: "images/test.jpg",
            status: "published",
          };

          const newSermon = DataService.create("sermons", testSermon);

          const status = document.getElementById("syncStatus");
          status.className = "status success";
          status.textContent = `‚úÖ Test sermon created: "${newSermon.title}"`;
          logEvent(`Created test sermon: ${newSermon.title}`);
          displayCurrentContent();
        } catch (error) {
          const status = document.getElementById("syncStatus");
          status.className = "status error";
          status.textContent = "Error creating test sermon: " + error.message;
          logEvent("Error creating test sermon: " + error.message, "error");
        }
      }

      // Automated testing functions
      function runAllTests() {
        try {
          logEvent("Starting automated tests...");
          const results = SyncVerification.runAllTests();

          const status = document.getElementById("testResults");
          const allPassed = Object.values(results).every((result) => result);

          if (allPassed) {
            status.className = "status success";
            status.textContent =
              "‚úÖ All tests passed! Sync functionality is working correctly.";
            logEvent("All automated tests passed");
          } else {
            status.className = "status error";
            const failedTests = Object.keys(results).filter(
              (test) => !results[test]
            );
            status.textContent = `‚ùå Some tests failed: ${failedTests.join(
              ", "
            )}`;
            logEvent(`Some tests failed: ${failedTests.join(", ")}`);
          }
        } catch (error) {
          const status = document.getElementById("testResults");
          status.className = "status error";
          status.textContent = "Error running tests: " + error.message;
          logEvent("Error running automated tests: " + error.message, "error");
        }
      }

      function demonstrateSync() {
        try {
          logEvent("Starting sync demonstration...");
          SyncVerification.demonstrateSync();

          const status = document.getElementById("testResults");
          status.className = "status success";
          status.textContent =
            "üé¨ Sync demonstration started! Check the console and event log for details.";

          // Update content display after a delay to show the new items
          setTimeout(() => {
            displayCurrentContent();
            checkCurrentData();
          }, 3000);
        } catch (error) {
          const status = document.getElementById("testResults");
          status.className = "status error";
          status.textContent = "Error running demonstration: " + error.message;
          logEvent(
            "Error running sync demonstration: " + error.message,
            "error"
          );
        }
      }

      // Comprehensive testing functions
      function runComprehensiveTest() {
        try {
          logEvent("Starting comprehensive tests...");
          const results = ComprehensiveSyncTest.runCompleteTest();

          const status = document.getElementById("comprehensiveResults");
          const allPassed = Object.values(results).every((result) => result);

          if (allPassed) {
            status.className = "status success";
            status.textContent =
              "‚úÖ All comprehensive tests passed! Real-time sync is fully functional.";
            logEvent("All comprehensive tests passed");
          } else {
            status.className = "status error";
            const failedTests = Object.keys(results).filter(
              (test) => !results[test]
            );
            status.textContent = `‚ùå Some comprehensive tests failed: ${failedTests.join(
              ", "
            )}`;
            logEvent(
              `Some comprehensive tests failed: ${failedTests.join(", ")}`
            );
          }

          // Update content display to show test results
          setTimeout(() => {
            displayCurrentContent();
            checkCurrentData();
          }, 1000);
        } catch (error) {
          const status = document.getElementById("comprehensiveResults");
          status.className = "status error";
          status.textContent =
            "Error running comprehensive tests: " + error.message;
          logEvent(
            "Error running comprehensive tests: " + error.message,
            "error"
          );
        }
      }

      function demonstrateWorkflow() {
        try {
          logEvent("Starting complete workflow demonstration...");
          ComprehensiveSyncTest.demonstrateCompleteWorkflow();

          const status = document.getElementById("comprehensiveResults");
          status.className = "status success";
          status.textContent =
            "üé¨ Complete workflow demonstration started! Check console and frontend pages.";

          // Update content display after workflow completes
          setTimeout(() => {
            displayCurrentContent();
            checkCurrentData();
            logEvent(
              "Workflow demonstration completed - check frontend pages!"
            );
          }, 3000);
        } catch (error) {
          const status = document.getElementById("comprehensiveResults");
          status.className = "status error";
          status.textContent =
            "Error running workflow demonstration: " + error.message;
          logEvent(
            "Error running workflow demonstration: " + error.message,
            "error"
          );
        }
      }

      // Content display function
      function displayCurrentContent() {
        try {
          const blogs = JSON.parse(localStorage.getItem("blogs") || "[]");
          const events = JSON.parse(localStorage.getItem("events") || "[]");
          const sermons = JSON.parse(localStorage.getItem("sermons") || "[]");

          let html = "";

          if (blogs.length > 0) {
            html += "<h4>üìù Blog Posts:</h4>";
            blogs.forEach((blog) => {
              html += `<div class="content-item"><strong>${blog.title}</strong> - ${blog.status}</div>`;
            });
          }

          if (events.length > 0) {
            html += "<h4>üìÖ Events:</h4>";
            events.forEach((event) => {
              html += `<div class="content-item"><strong>${event.title}</strong> - ${event.status}</div>`;
            });
          }

          if (sermons.length > 0) {
            html += "<h4>üé§ Sermons:</h4>";
            sermons.forEach((sermon) => {
              html += `<div class="content-item"><strong>${sermon.title}</strong> by ${sermon.speaker} - ${sermon.status}</div>`;
            });
          }

          if (html === "") {
            html =
              '<p>No content found. Click "Seed Sample Data" to create some test content.</p>';
          }

          document.getElementById("contentDisplay").innerHTML = html;
        } catch (error) {
          document.getElementById("contentDisplay").innerHTML =
            '<p class="error">Error displaying content: ' +
            error.message +
            "</p>";
          logEvent("Error displaying content: " + error.message, "error");
        }
      }

      // Listen for sync events
      window.addEventListener("contentSync", function (event) {
        const syncData = event.detail;
        logEvent(
          `Sync event detected: ${syncData.action} ${syncData.contentType} - ${
            syncData.item?.title || syncData.item?.id
          }`
        );
      });

      window.addEventListener("storage", function (event) {
        if (event.key === "lastSync") {
          const syncData = JSON.parse(event.newValue || "{}");
          logEvent(
            `Storage sync event: ${syncData.action} ${syncData.contentType} (cross-tab)`
          );
        }
      });

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        logEvent("Real-time sync test page loaded");
        checkCurrentData();
        displayCurrentContent();
      });
    </script>
  </body>
</html>
